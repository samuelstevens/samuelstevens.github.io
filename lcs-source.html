<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="/css/site.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta charset="utf-8" />
  <meta name="description" content="" />
  <meta name="keywords" content="" />
  <title>Behold: lcs.c</title>
  <meta name="robots" content="noindex"> <meta name="googlebot" content="noindex">
</head>

<body>
  <main>
    <header>
      <h1>Behold, My Stuff</h1>
      <p>
        [<a href="/">Home</a>]
        [<a href="/writing">Writing</a>]
        [<a href="https://www.youtube.com/watch?v=SHbS9tYFpcQ">Relevant link</a>]
      </p>
    </header>

    <article>
      <!-- Must be unindented to prevent code indentation being broken -->
<p>Source code for <code>lcs.c</code> in <a href="/writing/optimizing-python-code-with-ctypes">Optimizing Python Code with <code>ctypes</code></a>.</p>
<p>This code is licensed under <a href="/license-gnu">GNU AGPLv3</a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1"></a>lcs.c; finds the longest common sequence in a list of strings.</span>
<span id="cb1-2"><a href="#cb1-2"></a>Copyright (C) &lt;<span class="dv">2020</span>&gt;  &lt;Samuel Stevens&gt;</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a>This program is free software: you can redistribute it and/or modify</span>
<span id="cb1-5"><a href="#cb1-5"></a>it under the terms of the GNU Affero General Public License as published</span>
<span id="cb1-6"><a href="#cb1-6"></a>by the Free Software Foundation, either version <span class="dv">3</span> of the License, or</span>
<span id="cb1-7"><a href="#cb1-7"></a>(at your option) any later version.</span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a>This program is distributed in the hope that it will be useful,</span>
<span id="cb1-10"><a href="#cb1-10"></a>but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span id="cb1-11"><a href="#cb1-11"></a>MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span id="cb1-12"><a href="#cb1-12"></a>GNU Affero General Public License <span class="cf">for</span> more details.</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a>You should have received a copy of the GNU Affero General Public License</span>
<span id="cb1-15"><a href="#cb1-15"></a>along with this program.  If not, see &lt;https:<span class="co">//www.gnu.org/licenses/&gt;.</span></span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="kw">struct</span> Sequence</span>
<span id="cb1-22"><a href="#cb1-22"></a>{</span>
<span id="cb1-23"><a href="#cb1-23"></a>  <span class="dt">char</span> **items;</span>
<span id="cb1-24"><a href="#cb1-24"></a>  <span class="dt">int</span> length;</span>
<span id="cb1-25"><a href="#cb1-25"></a>};</span>
<span id="cb1-26"><a href="#cb1-26"></a></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="kw">struct</span> Cell</span>
<span id="cb1-28"><a href="#cb1-28"></a>{</span>
<span id="cb1-29"><a href="#cb1-29"></a>  <span class="dt">int</span> index;</span>
<span id="cb1-30"><a href="#cb1-30"></a>  <span class="dt">int</span> length;</span>
<span id="cb1-31"><a href="#cb1-31"></a>  <span class="kw">struct</span> Cell *prev;</span>
<span id="cb1-32"><a href="#cb1-32"></a>};</span>
<span id="cb1-33"><a href="#cb1-33"></a></span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="dt">void</span> printSequence(<span class="kw">struct</span> Sequence *seq)</span>
<span id="cb1-35"><a href="#cb1-35"></a>{</span>
<span id="cb1-36"><a href="#cb1-36"></a>  printf(<span class="st">&quot;%d</span><span class="sc">\n</span><span class="st">&quot;</span>, seq-&gt;length);</span>
<span id="cb1-37"><a href="#cb1-37"></a>  <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; seq-&gt;length; i++)</span>
<span id="cb1-38"><a href="#cb1-38"></a>  {</span>
<span id="cb1-39"><a href="#cb1-39"></a>    printf(<span class="st">&quot;%s &quot;</span>, seq-&gt;items[i]);</span>
<span id="cb1-40"><a href="#cb1-40"></a>  }</span>
<span id="cb1-41"><a href="#cb1-41"></a>  printf(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb1-42"><a href="#cb1-42"></a>}</span>
<span id="cb1-43"><a href="#cb1-43"></a></span>
<span id="cb1-44"><a href="#cb1-44"></a><span class="dt">void</span> printCell(<span class="kw">struct</span> Cell *cell)</span>
<span id="cb1-45"><a href="#cb1-45"></a>{</span>
<span id="cb1-46"><a href="#cb1-46"></a>  printf(<span class="st">&quot;index: %d</span><span class="sc">\t</span><span class="st"> length: %d </span><span class="sc">\t</span><span class="st">prev: %p</span><span class="sc">\n</span><span class="st">&quot;</span>, cell-&gt;index, cell-&gt;length, cell-&gt;prev);</span>
<span id="cb1-47"><a href="#cb1-47"></a>}</span>
<span id="cb1-48"><a href="#cb1-48"></a></span>
<span id="cb1-49"><a href="#cb1-49"></a><span class="kw">struct</span> Sequence *lcs(<span class="kw">struct</span> Sequence *s1, <span class="kw">struct</span> Sequence *s2)</span>
<span id="cb1-50"><a href="#cb1-50"></a>{</span>
<span id="cb1-51"><a href="#cb1-51"></a>  <span class="kw">struct</span> Sequence *common = malloc(<span class="kw">sizeof</span>(<span class="kw">struct</span> Sequence));</span>
<span id="cb1-52"><a href="#cb1-52"></a>  common-&gt;length = <span class="dv">0</span>;</span>
<span id="cb1-53"><a href="#cb1-53"></a>  common-&gt;items = NULL;</span>
<span id="cb1-54"><a href="#cb1-54"></a></span>
<span id="cb1-55"><a href="#cb1-55"></a>  <span class="dt">char</span> **seq1 = s1-&gt;items;</span>
<span id="cb1-56"><a href="#cb1-56"></a>  <span class="dt">char</span> **seq2 = s2-&gt;items;</span>
<span id="cb1-57"><a href="#cb1-57"></a></span>
<span id="cb1-58"><a href="#cb1-58"></a>  <span class="cf">if</span> (!s1-&gt;length || !s2-&gt;length)</span>
<span id="cb1-59"><a href="#cb1-59"></a>  {</span>
<span id="cb1-60"><a href="#cb1-60"></a>    <span class="cf">return</span> common;</span>
<span id="cb1-61"><a href="#cb1-61"></a>  }</span>
<span id="cb1-62"><a href="#cb1-62"></a></span>
<span id="cb1-63"><a href="#cb1-63"></a>  <span class="kw">struct</span> Cell table[s1-&gt;length][s2-&gt;length];</span>
<span id="cb1-64"><a href="#cb1-64"></a></span>
<span id="cb1-65"><a href="#cb1-65"></a>  <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; s1-&gt;length; i++)</span>
<span id="cb1-66"><a href="#cb1-66"></a>  {</span>
<span id="cb1-67"><a href="#cb1-67"></a>    <span class="cf">for</span> (<span class="dt">int</span> j = <span class="dv">0</span>; j &lt; s2-&gt;length; j++)</span>
<span id="cb1-68"><a href="#cb1-68"></a>    {</span>
<span id="cb1-69"><a href="#cb1-69"></a>      table[i][j].length = <span class="dv">0</span>;</span>
<span id="cb1-70"><a href="#cb1-70"></a>      <span class="cf">if</span> (!strcmp(seq1[i], seq2[j]))</span>
<span id="cb1-71"><a href="#cb1-71"></a>      {</span>
<span id="cb1-72"><a href="#cb1-72"></a>        table[i][j].index = j;</span>
<span id="cb1-73"><a href="#cb1-73"></a>        <span class="cf">if</span> (i &gt; <span class="dv">0</span> &amp;&amp; j &gt; <span class="dv">0</span>)</span>
<span id="cb1-74"><a href="#cb1-74"></a>        {</span>
<span id="cb1-75"><a href="#cb1-75"></a>          table[i][j].prev = &amp;table[i - <span class="dv">1</span>][j - <span class="dv">1</span>];</span>
<span id="cb1-76"><a href="#cb1-76"></a>          table[i][j].length = table[i - <span class="dv">1</span>][j - <span class="dv">1</span>].length + <span class="dv">1</span>;</span>
<span id="cb1-77"><a href="#cb1-77"></a>        }</span>
<span id="cb1-78"><a href="#cb1-78"></a>        <span class="cf">else</span></span>
<span id="cb1-79"><a href="#cb1-79"></a>        {</span>
<span id="cb1-80"><a href="#cb1-80"></a>          table[i][j].prev = NULL;</span>
<span id="cb1-81"><a href="#cb1-81"></a>          table[i][j].length = <span class="dv">1</span>;</span>
<span id="cb1-82"><a href="#cb1-82"></a>        }</span>
<span id="cb1-83"><a href="#cb1-83"></a>      }</span>
<span id="cb1-84"><a href="#cb1-84"></a>      <span class="cf">else</span></span>
<span id="cb1-85"><a href="#cb1-85"></a>      {</span>
<span id="cb1-86"><a href="#cb1-86"></a>        table[i][j].index = -<span class="dv">1</span>;</span>
<span id="cb1-87"><a href="#cb1-87"></a>        table[i][j].prev = NULL;</span>
<span id="cb1-88"><a href="#cb1-88"></a>        <span class="cf">if</span> (i &gt; <span class="dv">0</span>)</span>
<span id="cb1-89"><a href="#cb1-89"></a>        {</span>
<span id="cb1-90"><a href="#cb1-90"></a>          table[i][j].prev = &amp;table[i - <span class="dv">1</span>][j];</span>
<span id="cb1-91"><a href="#cb1-91"></a>          table[i][j].length = table[i - <span class="dv">1</span>][j].length;</span>
<span id="cb1-92"><a href="#cb1-92"></a>        }</span>
<span id="cb1-93"><a href="#cb1-93"></a></span>
<span id="cb1-94"><a href="#cb1-94"></a>        <span class="cf">if</span> (j &gt; <span class="dv">0</span>)</span>
<span id="cb1-95"><a href="#cb1-95"></a>        {</span>
<span id="cb1-96"><a href="#cb1-96"></a>          <span class="cf">if</span> (table[i][j - <span class="dv">1</span>].length &gt; table[i][j].length)</span>
<span id="cb1-97"><a href="#cb1-97"></a>          {</span>
<span id="cb1-98"><a href="#cb1-98"></a>            table[i][j].prev = &amp;table[i][j - <span class="dv">1</span>];</span>
<span id="cb1-99"><a href="#cb1-99"></a>            table[i][j].length = table[i][j - <span class="dv">1</span>].length;</span>
<span id="cb1-100"><a href="#cb1-100"></a>          }</span>
<span id="cb1-101"><a href="#cb1-101"></a>        }</span>
<span id="cb1-102"><a href="#cb1-102"></a>      }</span>
<span id="cb1-103"><a href="#cb1-103"></a>    }</span>
<span id="cb1-104"><a href="#cb1-104"></a>  }</span>
<span id="cb1-105"><a href="#cb1-105"></a></span>
<span id="cb1-106"><a href="#cb1-106"></a>  <span class="dt">int</span> i = s1-&gt;length - <span class="dv">1</span>;</span>
<span id="cb1-107"><a href="#cb1-107"></a>  <span class="dt">int</span> j = s2-&gt;length - <span class="dv">1</span>;</span>
<span id="cb1-108"><a href="#cb1-108"></a>  <span class="kw">struct</span> Cell *cur = &amp;table[i][j];</span>
<span id="cb1-109"><a href="#cb1-109"></a></span>
<span id="cb1-110"><a href="#cb1-110"></a>  common-&gt;length = cur-&gt;length;</span>
<span id="cb1-111"><a href="#cb1-111"></a>  common-&gt;items = malloc(<span class="kw">sizeof</span>(<span class="dt">char</span> *) * common-&gt;length);</span>
<span id="cb1-112"><a href="#cb1-112"></a></span>
<span id="cb1-113"><a href="#cb1-113"></a>  i = cur-&gt;length - <span class="dv">1</span>;</span>
<span id="cb1-114"><a href="#cb1-114"></a></span>
<span id="cb1-115"><a href="#cb1-115"></a>  <span class="cf">while</span> (cur)</span>
<span id="cb1-116"><a href="#cb1-116"></a>  {</span>
<span id="cb1-117"><a href="#cb1-117"></a>    <span class="cf">if</span> (cur-&gt;index &lt; <span class="dv">0</span>)</span>
<span id="cb1-118"><a href="#cb1-118"></a>    {</span>
<span id="cb1-119"><a href="#cb1-119"></a>      cur = cur-&gt;prev;</span>
<span id="cb1-120"><a href="#cb1-120"></a>      <span class="cf">continue</span>;</span>
<span id="cb1-121"><a href="#cb1-121"></a>    }</span>
<span id="cb1-122"><a href="#cb1-122"></a></span>
<span id="cb1-123"><a href="#cb1-123"></a>    common-&gt;items[i] = malloc(</span>
<span id="cb1-124"><a href="#cb1-124"></a>      <span class="kw">sizeof</span>(<span class="dt">char</span>) *</span>
<span id="cb1-125"><a href="#cb1-125"></a>      (strlen(seq2[cur-&gt;index]) + <span class="dv">1</span>));</span>
<span id="cb1-126"><a href="#cb1-126"></a></span>
<span id="cb1-127"><a href="#cb1-127"></a>    strcpy(common-&gt;items[i], seq2[cur-&gt;index]);</span>
<span id="cb1-128"><a href="#cb1-128"></a>    cur = cur-&gt;prev;</span>
<span id="cb1-129"><a href="#cb1-129"></a>    i--;</span>
<span id="cb1-130"><a href="#cb1-130"></a>  }</span>
<span id="cb1-131"><a href="#cb1-131"></a>  <span class="cf">return</span> common;</span>
<span id="cb1-132"><a href="#cb1-132"></a>}</span>
<span id="cb1-133"><a href="#cb1-133"></a></span>
<span id="cb1-134"><a href="#cb1-134"></a><span class="dt">void</span> freeSequence(<span class="kw">struct</span> Sequence *seq)</span>
<span id="cb1-135"><a href="#cb1-135"></a>{</span>
<span id="cb1-136"><a href="#cb1-136"></a>  free(seq);</span>
<span id="cb1-137"><a href="#cb1-137"></a>}</span>
<span id="cb1-138"><a href="#cb1-138"></a></span>
<span id="cb1-139"><a href="#cb1-139"></a><span class="co">/*</span></span>
<span id="cb1-140"><a href="#cb1-140"></a><span class="co">Must be called like so:</span></span>
<span id="cb1-141"><a href="#cb1-141"></a><span class="co">./lcs &lt;length 1&gt; &lt;length 2&gt; &lt;sequence&gt; &lt;of&gt; &lt;words1&gt; &lt;sequence2&gt; </span></span>
<span id="cb1-142"><a href="#cb1-142"></a><span class="co">*/</span></span>
<span id="cb1-143"><a href="#cb1-143"></a><span class="dt">int</span> main(<span class="dt">int</span> argc, <span class="dt">char</span> **argv)</span>
<span id="cb1-144"><a href="#cb1-144"></a>{</span>
<span id="cb1-145"><a href="#cb1-145"></a>  <span class="cf">if</span> (argc &lt; <span class="dv">3</span>)</span>
<span id="cb1-146"><a href="#cb1-146"></a>  {</span>
<span id="cb1-147"><a href="#cb1-147"></a>    printf(<span class="st">&quot;You must provide at least 3 arguments.</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb1-148"><a href="#cb1-148"></a>    <span class="cf">return</span> -<span class="dv">1</span>;</span>
<span id="cb1-149"><a href="#cb1-149"></a>  }</span>
<span id="cb1-150"><a href="#cb1-150"></a></span>
<span id="cb1-151"><a href="#cb1-151"></a>  <span class="dt">int</span> len1 = atoi(argv[<span class="dv">1</span>]);</span>
<span id="cb1-152"><a href="#cb1-152"></a>  <span class="dt">int</span> len2 = atoi(argv[<span class="dv">2</span>]);</span>
<span id="cb1-153"><a href="#cb1-153"></a></span>
<span id="cb1-154"><a href="#cb1-154"></a>  <span class="cf">if</span> (argc &lt; <span class="dv">3</span> + len1 + len2)</span>
<span id="cb1-155"><a href="#cb1-155"></a>  {</span>
<span id="cb1-156"><a href="#cb1-156"></a>    printf(<span class="st">&quot;Sequence lengths must be valid.</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb1-157"><a href="#cb1-157"></a>    <span class="cf">return</span> -<span class="dv">1</span>;</span>
<span id="cb1-158"><a href="#cb1-158"></a>  }</span>
<span id="cb1-159"><a href="#cb1-159"></a></span>
<span id="cb1-160"><a href="#cb1-160"></a>  <span class="dt">char</span> **s1 = &amp;argv[<span class="dv">3</span>];</span>
<span id="cb1-161"><a href="#cb1-161"></a>  <span class="dt">char</span> **s2 = &amp;argv[<span class="dv">3</span> + len1];</span>
<span id="cb1-162"><a href="#cb1-162"></a></span>
<span id="cb1-163"><a href="#cb1-163"></a>  <span class="kw">struct</span> Sequence seq1;</span>
<span id="cb1-164"><a href="#cb1-164"></a>  seq1.items = s1;</span>
<span id="cb1-165"><a href="#cb1-165"></a>  seq1.length = len1;</span>
<span id="cb1-166"><a href="#cb1-166"></a></span>
<span id="cb1-167"><a href="#cb1-167"></a>  <span class="kw">struct</span> Sequence seq2;</span>
<span id="cb1-168"><a href="#cb1-168"></a>  seq2.items = s2;</span>
<span id="cb1-169"><a href="#cb1-169"></a>  seq2.length = len2;</span>
<span id="cb1-170"><a href="#cb1-170"></a></span>
<span id="cb1-171"><a href="#cb1-171"></a>  <span class="kw">struct</span> Sequence *common = lcs(&amp;seq1, &amp;seq2);</span>
<span id="cb1-172"><a href="#cb1-172"></a></span>
<span id="cb1-173"><a href="#cb1-173"></a>  printSequence(common);</span>
<span id="cb1-174"><a href="#cb1-174"></a>}</span></code></pre></div>
      <hr />
      <p>[<a href="https://www.youtube.com/watch?v=SHbS9tYFpcQ">Relevant link</a>]</p>
      <p>Sam Stevens, 2020</p>
      <p>
        <a href="https://github.com/samuelstevens/personal-website">Source</a>
      </p>
    </article>
  </main>
  <script src="/js/instantclick.min.js" data-no-instant></script>
  <script data-no-instant>
    InstantClick.init();
  </script>
  <style>
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</body>

</html>